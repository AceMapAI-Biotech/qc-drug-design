from pyscf import solvent
from pyscf.mcscf import CASCI
from pyscf.lib import logger
import time



from tencirchem import HEA, M, UCC

geom_gaussian4 = """
 O                 -1.12823800    0.63904700   -1.60489900
 C                  2.11270000   -0.89702300    0.45396900
 O                  1.00849600   -2.95386800    0.68714000
 C                  0.91491200   -1.75718200    0.15204000
 O                  3.31093900   -1.65776800    0.50275900
 H                  3.21218000   -2.33931500    1.19065800
 C                 -0.22346600   -1.24948400   -0.45541700
 C                 -1.56131500   -1.94516600   -0.40581100
 H                 -1.66430300   -2.47005900    0.54871000
 H                 -1.63376100   -2.70098000   -1.19720400
 C                 -2.68824400   -0.92007800   -0.52915000
 H                 -3.64989300   -1.42677400   -0.65360500
 H                 -2.73706900   -0.32334800    0.38733400
 C                 -2.48696100    0.02096000   -1.70904400
 C                 -0.10878600    0.01309600   -1.06697100
 C                  1.16125700    0.71846300   -1.20660400
 C                  1.26982700    1.86113400   -2.01851600
 H                  0.39671000    2.23300400   -2.54156100
 C                  2.49452900    2.50625200   -2.14680100
 H                  2.57909800    3.38680400   -2.77625300
 C                  3.61551600    2.01704300   -1.46444200
 H                  4.57427100    2.51707600   -1.56619400
 C                  3.50897200    0.89045500   -0.64716000
 H                  4.37495900    0.52776000   -0.10499600
 C                  2.28602400    0.23103500   -0.52047500
 C                 -3.42976200    1.21149000   -1.65146400
 H                 -4.46075900    0.85701600   -1.75276100
 H                 -3.33280400    1.73545500   -0.69505200
 H                 -3.22150900    1.91111700   -2.46754900
 C                 -2.52222000   -0.67655700   -3.06425000
 H                 -3.51078800   -1.12450400   -3.21043200
 H                 -2.34337400    0.04428300   -3.86825900
 H                 -1.76908800   -1.46750100   -3.13036700
 C                  1.85291200   -0.26255500    1.90779700
 H                  1.83836400   -1.11609900    2.59495500
 H                  2.75876100    0.32092600    2.09826400
 C                  0.61285300    0.56386800    2.06226900
 C                  0.55900000    1.90976700    1.65709800
 H                  1.45994800    2.38380300    1.27194100
 C                 -0.62200600    2.64521000    1.71433900
 H                 -0.63295800    3.68161300    1.38190400
 C                 -1.83964200    2.07428900    2.19193700
 C                 -1.76013400    0.71655900    2.62868600
 H                 -2.66380200    0.24360100    3.00830500
 C                 -0.57509500   -0.00652500    2.55358300
 H                 -0.56747800   -1.04928400    2.86821900
 O                 -2.96623700    2.75028600    2.22689400
 H                  0.25476100   -3.60494700    0.51339200
 H                 -1.33284600   -4.84978000   -0.26150400
 H                 -0.05021500   -5.65853900    0.01084400
 O                 -0.63791400   -4.99040300    0.40529600
"""

geom_pyscf5 = """
 C   0.000091   1.404769  -0.000000
 C   0.000006   0.634201  -1.250651
 C  -0.000131  -0.696020  -1.259192
 C  -0.000208  -1.475784   0.000000
 C  -0.000131  -0.696020   1.259192
 C   0.000006   0.634201   1.250651
 O  -0.000322  -2.676784  -0.000000
 C   0.000226   2.737400   0.000000
 H   0.000070   1.187083  -2.173806
 H  -0.000181  -1.263378  -2.171542
 H  -0.000181  -1.263378   2.171542
 H   0.000070   1.187083   2.173806
 H   0.000261   3.301025  -0.915540
 H   0.000261   3.301025   0.915540
"""

geom_gaussian5 = """
 C     0.00000800    1.39812400    0.00000000
 C    -0.00000200    0.64420900    1.24608200
 C    -0.00000200   -0.70980600    1.25056200
 C     0.00003300   -1.46955300    0.00000000
 C    -0.00000200   -0.70980600   -1.25056200
 C    -0.00000200    0.64420900   -1.24608200
 O    -0.00003200   -2.72480100    0.00000000
 C     0.00001300    2.75406900    0.00000000
 H    -0.00001100    1.20486000    2.17731400
 H    -0.00001700   -1.27704300    2.17689300
 H    -0.00001700   -1.27704300   -2.17689300
 H    -0.00001100    1.20486000   -2.17731400
 H     0.00001500    3.31704500    0.92947800
 H     0.00001500    3.31704500   -0.92947800
"""

geom_pyscf6 ="""
   C  -3.406279  -2.053850   0.018601
   C  -2.248938  -2.863895  -0.013194
   C  -1.010599  -2.294358  -0.054259
   C  -0.865968  -0.883956  -0.065361
   C  -2.020301  -0.079764  -0.033650
   C  -3.296547  -0.695065   0.009130
   C   0.419461  -0.258474  -0.115376
   C   0.541687   1.096205  -0.138754
   C  -0.641938   1.886575  -0.074291
   C  -1.876702   1.336333  -0.033342
   O   1.479318  -1.100057  -0.169595
   C   2.790062  -0.595536   0.077710
   C   2.953688   0.733254  -0.663086
   C   1.896936   1.753796  -0.244717
   C   3.731061  -1.650934  -0.488699
   C   2.992333  -0.456594   1.588198
   H  -4.377535  -2.514603   0.049893
   H  -2.348575  -3.934678  -0.005787
   H  -0.129397  -2.904847  -0.080583
   H  -4.170291  -0.072853   0.032749
   H   3.950984   1.127573  -0.494453
   H   2.858933   0.539212  -1.727391
   H   1.857816   2.558434  -0.971557
   H   2.172802   2.211877   0.704834
   H   3.566876  -1.776743  -1.552983
   H   4.765922  -1.363376  -0.329441
   H   3.563466  -2.606489  -0.004168
   H   2.883680  -1.423899   2.066150
   H   3.986652  -0.077533   1.805443
   H   2.268174   0.215050   2.033636
   O  -2.998780   2.092332   0.009437
   H  -2.754457   3.008836  -0.039255
   O  -0.566418   3.259282  -0.120279
   H  -0.003230   3.594444   0.565483
"""

geom_gaussian6 = """
 C                 -3.43826600   -2.08244300    0.02336700
 C                 -2.28089000   -2.89537600   -0.05080200
 C                 -1.02828100   -2.31706000   -0.10462100
 C                 -0.87541500   -0.90544700   -0.08893200
 C                 -2.04800200   -0.08409300   -0.00830200
 C                 -3.32455700   -0.70744800    0.04622000
 C                  0.40580800   -0.27762200   -0.15137900
 C                  0.54111500    1.10120500   -0.14413900
 C                 -0.63659200    1.88763500   -0.03177700
 C                 -1.89366600    1.32363500    0.02764500
 O                  1.48198800   -1.12925400   -0.24079200
 C                  2.80896200   -0.58720600    0.07160000
 C                  2.96659400    0.74489900   -0.66436800
 C                  1.89863300    1.75546800   -0.24055500
 C                  3.78386800   -1.62954200   -0.45789300
 C                  2.92817000   -0.44427400    1.58984600
 H                 -4.42082700   -2.54463800    0.06452700
 H                 -2.38038100   -3.97717300   -0.06399500
 H                 -0.14248700   -2.94022800   -0.15984100
 H                 -4.21233000   -0.08660000    0.10535300
 H                  3.96671000    1.14719700   -0.47460300
 H                  2.88580700    0.55018000   -1.74044600
 H                  1.87553900    2.57436600   -0.97139000
 H                  2.16347200    2.20877400    0.72508600
 H                  3.67824800   -1.74472700   -1.54220100
 H                  4.81144900   -1.32014200   -0.23947500
 H                  3.60716900   -2.60002700    0.01903900
 H                  2.82937300   -1.42423000    2.06897700
 H                  3.90861000   -0.02854800    1.84731800
 H                  2.15892100    0.21733400    1.99932000
 O                 -3.02867700    2.11293100    0.13232600
 H                 -2.75070300    3.04606200    0.15533100
 O                 -0.59635200    3.27098800    0.01980900
 H                  0.32088600    3.59110100    0.02078800
"""

geom_h2o = """
 O                  0.00000000    0.00000000    0.11927500
 H                  0.00000000    0.76738300   -0.47709900
 H                  0.00000000   -0.76738300   -0.47709900
 """


geom_ts = """
 O                 -1.17056300   -0.71218800    1.42994200
 C                  2.18641900    1.05000500   -0.17838100
 O                  1.10556500    3.08438500   -0.47310600
 C                  0.99610300    1.83630800   -0.00052000
 O                  3.37448800    1.72691500   -0.42779900
 H                  3.16668300    2.51607500   -0.96045000
 C                 -0.18354000    1.26715700    0.49117000
 C                 -1.50477300    1.99561200    0.46819000
 H                 -1.60907000    2.56004000   -0.46254500
 H                 -1.53517200    2.72893300    1.28442600
 C                 -2.67586600    1.01984300    0.58553400
 H                 -3.59938000    1.56587900    0.80139900
 H                 -2.81234900    0.49368900   -0.36326600
 C                 -2.45826800   -0.02007200    1.67849700
 C                 -0.10444800   -0.03861500    0.99155000
 C                  1.14371400   -0.76018200    1.10988700
 C                  1.21667400   -2.01453200    1.75434300
 H                  0.31401100   -2.46055600    2.15472400
 C                  2.43137300   -2.66966800    1.86970400
 H                  2.48179400   -3.63398800    2.36654600
 C                  3.60056500   -2.08613000    1.34485300
 H                  4.55230700   -2.60078300    1.44136200
 C                  3.54577700   -0.85670900    0.70280800
 H                  4.44478700   -0.41406800    0.28831600
 C                  2.31989800   -0.17799900    0.58194900
 C                 -3.49332700   -1.13176100    1.60321500
 H                 -4.49338400   -0.70781300    1.74227700
 H                 -3.45579400   -1.62488300    0.62634400
 H                 -3.32101100   -1.87822200    2.38601800
 C                 -2.37113700    0.58319400    3.07847100
 H                 -3.31250100    1.09111200    3.31478800
 H                 -2.20356800   -0.20326800    3.82136900
 H                 -1.55887700    1.31261400    3.15581100
 C                  1.73818600    0.27985500   -1.99974200
 H                  1.72026800    1.23740700   -2.51827600
 H                  2.69458300   -0.23500500   -2.05009300
 C                  0.56283800   -0.52782100   -2.06126300
 C                  0.59321700   -1.90865300   -1.71709600
 H                  1.54534200   -2.35107600   -1.43215200
 C                 -0.54600300   -2.68400800   -1.72325600
 H                 -0.50022100   -3.73484100   -1.44690000
 C                 -1.82648300   -2.13456500   -2.07964100
 C                 -1.84327300   -0.74287800   -2.44730500
 H                 -2.79661500   -0.30286600   -2.72957600
 C                 -0.69999500    0.02390700   -2.41680200
 H                 -0.75151100    1.08078900   -2.67123100
 O                 -2.90461200   -2.84792200   -2.06805700
 H                  0.28210400    3.65512800   -0.48135000
 H                 -1.13370600    4.92355500   -1.42401400
 H                 -1.43261500    4.89419000    0.08384900
 O                 -0.71138100    5.03308900   -0.55402500
"""

from datetime import datetime

now = datetime.now()

current_time = now.strftime("%H:%M:%S")
print("Current Time =", current_time)

basis = "6-311+g(d,p)"
basis = "6-311g(d,p)"
mol_eq = M(atom=geom_gaussian6, basis=basis)
ne, no = 2, 2
do_qc = False
qc_engine = "qpu"

print("without solvent")
if do_qc:
    hea = HEA.from_molecule(mol_eq, active_space=(ne, no), n_layers=1)
    hea.kernel()
    hea.print_summary()
    print(hea.energy(engine=qc_engine))
else:
    hf = mol_eq.HF()
    print(hf.kernel())
    casci = CASCI(hf ,no, ne)
    casci.kernel()

print()
print ("with solvent")

hf = mol_eq.HF().ddCOSMO()
print(hf.kernel())
casci = CASCI(hf, no, ne)
casci = solvent.ddCOSMO(casci)
casci.canonicalization = False
if do_qc:
    # set the FCI solver for CASSCF to be HEA
    casci.fcisolver = HEA.as_pyscf_solver(engine=qc_engine, opt_engine="tensornetwork", n_layers=1)
casci.with_solvent.max_cycle = 0
casci.verbose = logger.INFO
time1 = time.time()
print(casci.kernel()[0])
print(time.time() - time1)

